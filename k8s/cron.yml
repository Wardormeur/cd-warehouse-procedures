apiVersion: batch/v2alpha1
kind: CronJob
metadata:
  name: warehouse-migration
  namespace: warehouse
spec:
  schedule: "0 1 1 * * "
  jobTemplate:
    spec:
      template:
        spec:
          imagePullSecrets:
            - name: regsecret
          containers:
            - name: migration
              image: coderdojo/cd-warehouse-procedures
              volumeMounts:
                - name: config-volume
                  mountPath: /usr/src/app/config
          volumes:
            - name: config-volume
              configMap:
                name: warehouse-config
          restartPolicy: OnFailure
